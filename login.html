<html>
  <head>
    <title>Logichain Login</title>
    <link
      href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link href="login_style.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="build/contracts/userData.json"></script>
  </head>

  <body class="flex w-screen h-screen justify-center items-center">
    <div class="flex-col space-y-2 justify-center items-center">
      <button
        id="loginButton"
        onclick=""
        class="mx-auto rounded-md p-2 bg-purple-500 text-white"
      >
        Login with MetaMask
      </button>
      <p id="userWallet" class="text-lg text-gray-600 my-2"></p>
      <img src="images/Logichain_logo.svg" alt="" width="500px" />
    </div>


        <footer>
          <div class="bottom">
            <center>
              <span class="credit"
                >Created By
                <a href="">Team Legion</a> |
              </span>
              <span class="far fa-copyright"></span
              ><span> 2021 All rights reserved.</span>
            </center>
          </div>
        </footer>

        <script>
          window.userWalletAddress = null;
          const loginButton = document.getElementById("loginButton");
          const userWallet = document.getElementById("userWallet");

          function toggleButton() {
            if (!window.ethereum) {
              loginButton.innerText = "MetaMask is not installed";
              loginButton.classList.remove("bg-purple-500", "text-white");
              loginButton.classList.add(
                "bg-gray-500",
                "text-gray-100",
                "cursor-not-allowed"
              );
              return false;
            }

            loginButton.addEventListener("click", loginWithMetaMask);
          }

          async function loginWithMetaMask() {
            const accounts = await window.ethereum
              .request({ method: "eth_requestAccounts" })
              .catch((e) => {
                console.error(e.message);
                return;
              });
            if (!accounts) {
              return;
            }

            // const dev_data = {
            //   priv_key = "0x4b0069d43378189e247377039933f7deeb916100d207b20231d9b8101f730a77",
            //   account_address = "0x33d3FA0db669C8ea67BaA4b87563298DE22bCc4a",
            //   ropsten_url = "https://ropsten.infura.io/v3/d1ed4d59de6b4faa878a943d8553d956",
            //   contract_address = "0xCF5712a30efF60A6b7d8424363360C8D90764c8D"
            // }
            // console.log(dev_data);
            // const web3 = new Web3(dev_data.ropsten_url);

            // let contract = await new web3.eth.Contract(
            //   userData.abi,
            //   dev_data.contract_address
            // );

            window.userWalletAddress = accounts[0];
            userWallet.innerText = window.userWalletAddress;
            loginButton.innerText = "Sign out of MetaMask";
            localStorage.setItem('account', accounts[0]);
            window.location.href="Dashboard.html";

            loginButton.removeEventListener("click", loginWithMetaMask);
            setTimeout(() => {
              loginButton.addEventListener("click", signOutOfMetaMask);
            }, 200);
          }

          function signOutOfMetaMask() {
            window.userWalletAddress = null;
            userWallet.innerText = "";
            loginButton.innerText = "Sign in with MetaMask";

            loginButton.removeEventListener("click", signOutOfMetaMask);
            setTimeout(() => {
              loginButton.addEventListener("click", loginWithMetaMask);
            }, 200);
          }

          window.addEventListener("DOMContentLoaded", () => {
            toggleButton();
          });
        </script>
      </body>
    </html>
  </body>
</html>
